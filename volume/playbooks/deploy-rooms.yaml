# This playbook deploys the rooms app

- hosts: apps

  roles:
    - {
        role: "service",
        service_name: "rooms",
        repository: "git@github.com:thefirstspine/rooms.git",
        deploy_private_key: "{{ deployment_private_key }}",
        docker_env: {
            AUTH_URL: "https://{{ service_auth_domain }}",
            PG_DATABASE: "{{ service_rooms_pg_database }}", # PostgreSQL database name
            PG_HOST: "{{ service_rooms_pg_host }}", # PostgreSQL database host
            PG_PORT: "{{ service_rooms_pg_port | int }}", # PostgreSQL database port
            PG_PASSWORD: "{{ service_rooms_pg_password }}", # PostgreSQL password
            PG_USERNAME: "{{ service_rooms_pg_username }}", # PostgreSQL username
            PRIVATE_KEY: "{{ service_rooms_private_key }}", # The secret key used to sign JWT
            MESSAGING_PUBLIC_KEY: "{{ service_rooms_messaging_public_key }}",
            SUBJECTS: "{{ service_rooms_subjects }}",
            PORT: "8080", # The port where to serve the app
            LOGS_LOGGLY_SUBDOMAIN: "{{ loggly_subdomain }}",
            LOGS_LOGGLY_TOKEN: "{{ loggly_token }}",
        },
        port_container: "8080",
        port_nginx: "{{ service_rooms_internal_port }}",
        domain: "{{ service_rooms_domain }}",
        cerbot_email: "{{ certbot_email }}",
        when: service_rooms|d('') == true
      }
